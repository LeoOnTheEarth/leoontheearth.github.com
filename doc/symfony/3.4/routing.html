<!DOCTYPE html>
<html class="wow-animation" lang="en">
<head>
    <meta charset="utf-8">
    <title>    Symfony 教學 Chapter 3. Routing | SPACECOWBOY.
</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <link rel="icon" href="/assets/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Questrial%7CLibre+Baskerville:400,400italic,700%7CLato:400,300">
    <link rel="stylesheet" href="/themes/default/css/style.css?v0.0.1">
    <style>.ie-panel{display: none;background: #212121;padding: 10px 0;box-shadow: 3px 3px 5px 0 rgba(0,0,0,.3);clear: both;text-align:center;position: relative;z-index: 1;} html.ie-10 .ie-panel, html.lt-ie-10 .ie-panel {display: block;}</style>

    <link rel="stylesheet" href="/themes/default/css/base.css?v0.0.1">

    <style type="text/css">
    @media (min-width: 1200px) {
        .section-split {
            width: 66%;
        }
    }
</style>
<link rel="stylesheet" href="/themes/default/css/article.css?v0.0.1">
<link rel="stylesheet" href="/themes/default/css/pygments-common.css?v0.0.1">
<link rel="stylesheet" href="/themes/default/css/pygments-symfony.css?v0.0.1">
</head>
<body>

<h1 class="d-none">Symfony 教學 Chapter 3. Routing | SPACECOWBOY.</h1>

<!-- IE Panel -->
<div class="ie-panel">
    <a href="http://windows.microsoft.com/en-US/internet-explorer/">
        <img src="/themes/default/images/ie8-panel/warning_bar_0000_us.jpg?v0.0.1" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today.">
    </a>
</div>

<!-- Page -->
<div class="page">
    <!-- Page Head -->
    <header class="page-head">
        <!-- RD Navbar Transparent -->
        <div class="rd-navbar-wrap">
            <nav class="rd-navbar rd-navbar-sidebar-fixed rd-navbar-light"
                 data-xl-layout="rd-navbar-sidebar-fixed"
                 data-lg-layout="rd-navbar-sidebar-fixed"
                 data-md-layout="rd-navbar-sidebar-fixed"
                 data-sm-layout="rd-navbar-sidebar-fixed"
                 data-xs-layout="rd-navbar-sidebar-fixed"
                 data-layout="rd-navbar-sidebar-fixed"
                 data-lg-auto-height="false"
                 data-lg-stick-up="false"
                 data-lg-hover-on="false"
                 data-body-class="body-inset-left"
            >
                <div class="rd-navbar-inner">
                    <!-- RD Navbar Panel -->
                    <div class="rd-navbar-panel">
                        <!-- RD Navbar Toggle -->
                        <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar, .rd-navbar-nav-wrap"><span></span></button>
                        <!-- Navbar Brand Mobile -->
                        <div class="rd-navbar-brand">
                            <a href="/">
                                <img width="170" height="27" src="/assets/images/logo.png" alt="" />
                            </a>
                        </div>
                        <!-- RD Navbar Search -->
                        <div class="rd-navbar-search">
                            <a class="rd-navbar-search-toggle" href="#"
                               data-rd-navbar-toggle=".rd-navbar-inner, .rd-navbar-search, .rd-navbar-sidebar-fixed-search">
                                <span class="icon icon-xxs text-middle"></span>
                            </a>
                        </div>
                    </div>
                    <div class="rd-navbar-menu-wrap">
                        <!-- RD Navbar Search -->
                        <div class="rd-navbar-sidebar-fixed-search">
                            <div class="container">
                                <form class="rd-search form-search" action="search-results.html" method="GET"
                                      data-search-filter="blog-archive-single*.html"
                                      data-search-live="rd-search-results-live"
                                      data-search-template="&lt;div class=&quot;search-fullscreen-results-item unit unit-horizontal&quot;&gt;&lt;div class=&quot;unit-left search-fullscreen-results-item-date&quot;&gt;#{date}&lt;/div&gt;&lt;div class=&quot;unit-body&quot;&gt;&lt;h3 class=&quot;search-fullscreen-results-item-title&quot;&gt;&lt;a href=&quot;#{href}&quot;&gt;#{title}&lt;/a&gt;&lt;/h3&gt;&lt;p class=&quot;search-fullscreen-results-item-tags&quot; &gt;in #{keywords}&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;"
                                >
                                    <div class="form-group">
                                        <label class="form-label form-search-label" for="ss">Type and hit Enter..</label>
                                        <div class="input-group">
                                            <input class="form-search-input form-control form-control-rect form-control-impressed custom-search-input"
                                                   id="ss" type="text" name="s" autocomplete="off" />
                                            <div class="input-group-addon">
                                                <span class="icon fa fa-circle-o-notch fa-spin icon-sm"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="form-search-submit" type="submit">
                                        <span class="mdi mdi-magnify"></span>
                                    </button>
                                </form>
                                <div class="rd-search-results-live offset-top-66 offset-xl-top-41 offset-xxl-top-66" id="rd-search-results-live"></div>
                            </div>
                        </div>
                        <div class="rd-navbar-nav-wrap">
                            <div class="rd-navbar-sidebar-fixed-menu">
                                <!-- title -->
                                <div class="rd-navbar-title d-none d-xl-block">
                                    <h1>
                                        <span class="big">Menu</span>
                                    </h1>
                                    <hr class="divider bg-primary d-none d-xl-block"/>
                                </div>
                                <div class="offset-xl-top-30">
                                    <!-- RD Navbar Nav -->
                                    <ul class="rd-navbar-nav">
                                                                            <li>
                                            <a href="/">
                                                <span>Home</span>
                                            </a>
                                        </li>
                                                                            <li>
                                            <a href="/tags">
                                                <span>Tags</span>
                                            </a>
                                        </li>
                                                                        </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main>
        
        <div class="bg-fixed"
     >
    <div class="section-split bg-white"
             style="margin-right: auto;"
        >
        <div class="inset-left-11p inset-right-11p section-98 section-md-110">
            <article>
                <div class="article-header text-center">
                    <div>
                        <span class="h6 d-block text-uppercase text-regular font-default text-spacing-120 text-primary pb-2">
                                                        <a href="/tag/php">PHP</a>,                                                        <a href="/tag/symfony">Symfony</a>,                                                        <a href="/tag/symfony-34">Symfony 3.4</a>                                                    </span>
                    </div>
                    <h1 class="font-weight-bold mt-0">
                        Symfony 教學 Chapter 3. Routing
                    </h1>
                    <time class="text-light" datetime="2018-01-01">
                        2019 February 16
                    </time>
                </div>

                <div class="article-content offset-top-24">
                    <h2>Routing</h2>

<p>對任何專業的網頁來說，有個漂亮的網址是絕對必須的。這代表說拋棄像是 <code>index.php?article_id=57</code> 的醜陋網址吧，改用這樣的網址 <code>/read/intro-to-symfony</code>。</p>

<p>保有彈性是更重要的，如果你想要將頁面的網址從 <code>/blog</code> 改成 <code>/news</code>，你會有多少連結需要被找到並修改他呢？如果你是用 Symfony 的 router，修改網址是很簡單的。</p>

<p>Symfony router 讓你可以定義有創意的網址，並對應到你的網頁應用中的不同區塊。在讀完本篇文章之後，你可以做到以下幾件事：</p>

<ul>
<li>建立複雜的 route，並對應到相關的 controller</li>
<li>在 template 或 controller 中產生網址字串</li>
<li>從 bundle (或其他方式) 載入 routing 資訊</li>
<li>對你的 route 除錯</li>
</ul>

<h2>Routing 範例</h2>

<p>一個 route 代表的是一個網址和一個 controller 之間的對應關係。舉個例子，假設你想在 <code>/blog/my-post</code> 或 <code>/blog/all-about-symfony</code> 網址中，在其對應的 controller 中查詢並顯示部落格的文章。這樣的 route 設定舉例如下：</p>

<div class="code-block config"><div id="config-2bfe7d0b17aaf453bf3630ea9235a33b" class="config">
    <ul class="nav nav-tabs" role="tablist"><li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#config-2bfe7d0b17aaf453bf3630ea9235a33b-0" role="tab">
        Annotation
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-2bfe7d0b17aaf453bf3630ea9235a33b-1" role="tab">
        Yaml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-2bfe7d0b17aaf453bf3630ea9235a33b-2" role="tab">
        Xml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-2bfe7d0b17aaf453bf3630ea9235a33b-3" role="tab">
        Php
    </a>
</li></ul>
    <div class="tab-content">
        <div class="code-block php annotation"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBundle/Controller/BlogController.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Matches /blog exactly</span>
<span class="sd">     *</span>
<span class="sd">     * @Route(&quot;/blog&quot;, name=&quot;blog_list&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Matches /blog/*</span>
<span class="sd">     *</span>
<span class="sd">     * @Route(&quot;/blog/{slug}&quot;, name=&quot;blog_show&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$slug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// $slug will equal the dynamic part of the URL</span>
        <span class="c1">// e.g. at /blog/yay-routing, then $slug=&#39;yay-routing&#39;</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>

<div class="code-block yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># app/config/routing.yml</span>
<span class="nt">blog_list</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">/blog</span>
    <span class="nt">defaults</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> _controller</span><span class="p">:</span> <span class="nv">AppBundle</span><span class="p p-Indicator">:</span><span class="nv">Blog</span><span class="p p-Indicator">:</span><span class="nv">list</span> <span class="p p-Indicator">}</span>

<span class="nt">blog_show</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">/blog/{slug}</span>
    <span class="nt">defaults</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> _controller</span><span class="p">:</span> <span class="nv">AppBundle</span><span class="p p-Indicator">:</span><span class="nv">Blog</span><span class="p p-Indicator">:</span><span class="nv">show</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div>

<div class="code-block xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- app/config/routing.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing</span>
<span class="s">        http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;blog_list&quot;</span> <span class="na">path=</span><span class="s">&quot;/blog&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;_controller&quot;</span><span class="nt">&gt;</span>AppBundle:Blog:list<span class="nt">&lt;/default&gt;</span>
    <span class="nt">&lt;/route&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;blog_show&quot;</span> <span class="na">path=</span><span class="s">&quot;/blog/{slug}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;_controller&quot;</span><span class="nt">&gt;</span>AppBundle:Blog:show<span class="nt">&lt;/default&gt;</span>
    <span class="nt">&lt;/route&gt;</span>
<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</td></tr></table></div>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// app/config/routing.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Route</span><span class="p">;</span>

<span class="nv">$routes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;blog_list&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/blog&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;_controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AppBundle:Blog:list&#39;</span><span class="p">,</span>
<span class="p">]));</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;blog_show&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/blog/{slug}&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;_controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AppBundle:Blog:show&#39;</span><span class="p">,</span>
<span class="p">]));</span>

<span class="k">return</span> <span class="nv">$routes</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
    </div>
</div></div>

<p>Thanks to these two routes:
因為有這兩個 route：</p>

<ul>
<li>如果使用者訪問 <code>/blog</code>，第一個 route 會命中並執行 <code>listAction()</code> 的方法。</li>
<li>如果使用者訪問 <code>/blog/*</code>，第二個 route 會命中並執行 <code>showAction()</code> 的方法，因為 route 的路徑是設定為 <code>/blog/{slug}</code>， <code>$slug</code> 這個參數會被傳遞至 <code>showAction()</code> 的方法內。舉個例子，如果使用者訪問 <code>/blog/yay-routing</code>，那 <code>$slug</code> 就會是 <code>yay-routing</code>。</li>
</ul>

<p>每當你的 route 路徑含有 <code>{placeholder}</code> 的部分，這個部分會變成一個萬用字元：他會匹配到 <em>任何</em> 文字。你的 controller <em>也</em> 可以包含一個 <code>$placeholder</code> 參數 (萬用字元和參數名稱 <em>必須</em> 要相同)。</p>

<div class="code-block caution"><div class="caution-title">
    <span class="fa-stack fa-md">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-exclamation fa-stack-1x fa-inverse"></i>
    </span>
    <span class="text">Caution</span>
</div><p>然而，<code>{placeholder}</code> 裡的斜線 <code>/</code> 預設會被忽略，因為 router 會用斜線分隔不同的 placeholder。想了解更多，可以閱讀 <a href="https://symfony.com/doc/3.4/routing/slash_in_parameter.html#routing-slash-in-parameter">How to Allow a "/" Character in a Route Parameter</a>.</p></div>

<p>每個 route 也有個名字：<code>blog_list</code> 和 <code>blog_show</code>，可以是任何名稱（只要每個名稱是唯一的就好），接下來你會用它產生網址。</p>

<div class="code-block sidebar"><p>不同格式的 Routing</p>

<p>每個 method 註解中的 <code>@Route</code> 被稱作 <code>*annotation*</code>，如果你想用YAML, XML 或 PHP 的格式來設定你的 route，那也是沒問題的！</p>

<p>在這些格式中，<code>defaults</code> 設定的 <code>_controller</code> 會讓 Symfony 知道當某個網址對應到該 route 時要執行那個 controller。<code>_controller</code> 也被稱作 <a href="https://symfony.com/doc/3.4/routing.html#controller-string-syntax">logical name</a>，有個相對應的格式指向相對應的 PHP class 和 method，也就是這個例子的 <code>AppBundle\Controller\BlogController::listAction</code> and <code>AppBundle\Controller\BlogController::showAction</code> 兩個 method。</p></div>

<p>Symfony router 的目的是建立網址和 controller 的關聯。在這過程中，你會習得各種建立 route 的技巧，就算是複雜的網址也可以很簡單。</p>

<h2>加入 {wildcard} 的限制條件 (<code>requirements</code>)</h2>

<p>假設 <code>blog_list</code> 的 route 顯示一個有分頁的部落格文章清單，網址像是 <code>/blog/2</code> 和 <code>/blog/3</code> 表示第2頁和第3頁。如果你設定 route 的路徑為 <code>/blog/{page}</code>，你會遇到一個問題：</p>

<ul>
<li>blog_list: <code>/blog/{page}</code> 會比對為 <code>/blog/*</code></li>
<li>blog_show: <code>/blog/{slug}</code> 會比對為 <code>/blog/*</code></li>
</ul>

<p>當兩個 route 對應到一樣的網址，<em>第一個</em>被載入的 route 會勝出 (比對成功)，也就是說 <code>/blog/yay-routing</code> 會比對到 <code>blog_list</code> 的 route，這不太妙喔！</p>

<p>要修正這個問題，加入一個 <code>requirements</code> 設定，讓 <code>{page}</code> 只允許數字的內容：</p>

<div class="code-block config"><div id="config-ac57c60401fb0f26b361ed2cfedd6449" class="config">
    <ul class="nav nav-tabs" role="tablist"><li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#config-ac57c60401fb0f26b361ed2cfedd6449-0" role="tab">
        Annotation
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-ac57c60401fb0f26b361ed2cfedd6449-1" role="tab">
        Yaml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-ac57c60401fb0f26b361ed2cfedd6449-2" role="tab">
        Xml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-ac57c60401fb0f26b361ed2cfedd6449-3" role="tab">
        Php
    </a>
</li></ul>
    <div class="tab-content">
        <div class="code-block php annotation"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBundle/Controller/BlogController.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/blog/{page}&quot;, name=&quot;blog_list&quot;, requirements={&quot;page&quot;=&quot;\d+&quot;})</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listAction</span><span class="p">(</span><span class="nv">$page</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/blog/{slug}&quot;, name=&quot;blog_show&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$slug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>

<div class="code-block yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># app/config/routing.yml</span>
<span class="nt">blog_list</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span>      <span class="l l-Scalar l-Scalar-Plain">/blog/{page}</span>
    <span class="nt">defaults</span><span class="p">:</span>  <span class="p p-Indicator">{</span><span class="nt"> _controller</span><span class="p">:</span> <span class="nv">AppBundle</span><span class="p p-Indicator">:</span><span class="nv">Blog</span><span class="p p-Indicator">:</span><span class="nv">list</span> <span class="p p-Indicator">}</span>
    <span class="nt">requirements</span><span class="p">:</span>
        <span class="nt">page</span><span class="p">:</span> <span class="s">&#39;\d+&#39;</span>

<span class="nt">blog_show</span><span class="p">:</span>
    <span class="c1"># ...</span>
</pre></div>
</td></tr></table></div>

<div class="code-block xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- app/config/routing.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing</span>
<span class="s">        http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;blog_list&quot;</span> <span class="na">path=</span><span class="s">&quot;/blog/{page}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;_controller&quot;</span><span class="nt">&gt;</span>AppBundle:Blog:list<span class="nt">&lt;/default&gt;</span>
        <span class="nt">&lt;requirement</span> <span class="na">key=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>\d+<span class="nt">&lt;/requirement&gt;</span>
    <span class="nt">&lt;/route&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</td></tr></table></div>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// app/config/routing.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Route</span><span class="p">;</span>

<span class="nv">$routes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;blog_list&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/blog/{page}&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;_controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AppBundle:Blog:list&#39;</span><span class="p">,</span>
<span class="p">],</span> <span class="p">[</span>
    <span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;\d+&#39;</span>
<span class="p">]));</span>

<span class="c1">// ...</span>

<span class="k">return</span> <span class="nv">$routes</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
    </div>
</div></div>

<p><code>\d+</code> 是正規表示式，會比對出一個任意長度的數字，結果如下：</p>

<table class="table table-bordered">
<thead class="table-active">
<tr>
  <th>URL</th>
  <th>Route</th>
  <th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
  <td>/blog/2</td>
  <td>blog_list</td>
  <td>$page = 2</td>
</tr>
<tr>
  <td>/blog/yay-routing</td>
  <td>blog_show</td>
  <td>$slug = yay-routing</td>
</tr>
</tbody>
</table>

<p>想了解更多其他 <code>requirements</code> 的用法，像是 HTTP method、hostname、和 dynamic expressions，請見 <a href="https://symfony.com/doc/3.4/routing/requirements.html"><em>How to Define Route Requirements</em></a>。</p>

<h2>給定 {placeholders} 一個預設值</h2>

<p>在之前的範例中，<code>blog_list</code> 的網址路徑為 <code>/blog/{page}</code>。如果用戶訪問 <code>/blog/1</code> 那就會匹配到該 route，但如果訪問 <code>/blog</code> 的話，則會無法匹配。只要你的 route 包含一個 <code>{placeholder}</code>，那他<em>必須</em>要有個值。</p>

<p>那要如何在訪問 <code>/blog</code> 時也能被匹配到 <code>blog_list</code> 呢？我們需要加一個預設值上去：</p>

<div class="code-block config"><div id="config-26a97a2a935ada13d78072900281b691" class="config">
    <ul class="nav nav-tabs" role="tablist"><li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#config-26a97a2a935ada13d78072900281b691-0" role="tab">
        Annotation
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-26a97a2a935ada13d78072900281b691-1" role="tab">
        Yaml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-26a97a2a935ada13d78072900281b691-2" role="tab">
        Xml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-26a97a2a935ada13d78072900281b691-3" role="tab">
        Php
    </a>
</li></ul>
    <div class="tab-content">
        <div class="code-block php annotation"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBundle/Controller/BlogController.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/blog/{page}&quot;, name=&quot;blog_list&quot;, requirements={&quot;page&quot;=&quot;\d+&quot;})</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listAction</span><span class="p">(</span><span class="nv">$page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>

<div class="code-block yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># app/config/routing.yml</span>
<span class="nt">blog_list</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span>      <span class="l l-Scalar l-Scalar-Plain">/blog/{page}</span>
    <span class="nt">defaults</span><span class="p">:</span>  <span class="p p-Indicator">{</span><span class="nt"> _controller</span><span class="p">:</span> <span class="nv">AppBundle</span><span class="p p-Indicator">:</span><span class="nv">Blog</span><span class="p p-Indicator">:</span><span class="nv">list</span><span class="p p-Indicator">,</span><span class="nt"> page</span><span class="p">:</span> <span class="nv">1</span> <span class="p p-Indicator">}</span>
    <span class="nt">requirements</span><span class="p">:</span>
        <span class="nt">page</span><span class="p">:</span> <span class="s">&#39;\d+&#39;</span>

<span class="nt">blog_show</span><span class="p">:</span>
    <span class="c1"># ...</span>
</pre></div>
</td></tr></table></div>

<div class="code-block xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- app/config/routing.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing</span>
<span class="s">        http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;blog_list&quot;</span> <span class="na">path=</span><span class="s">&quot;/blog/{page}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;_controller&quot;</span><span class="nt">&gt;</span>AppBundle:Blog:list<span class="nt">&lt;/default&gt;</span>
        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/default&gt;</span>

        <span class="nt">&lt;requirement</span> <span class="na">key=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>\d+<span class="nt">&lt;/requirement&gt;</span>
    <span class="nt">&lt;/route&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</td></tr></table></div>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// app/config/routing.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Route</span><span class="p">;</span>

<span class="nv">$routes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;blog_list&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span>
    <span class="s1">&#39;/blog/{page}&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s1">&#39;_controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AppBundle:Blog:list&#39;</span><span class="p">,</span>
        <span class="s1">&#39;page&#39;</span>        <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;\d+&#39;</span>
    <span class="p">]</span>
<span class="p">));</span>

<span class="c1">// ...</span>

<span class="k">return</span> <span class="nv">$routes</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
    </div>
</div></div>

<p>這樣的話，當用戶訪問 <code>/blog</code> 時 <code>blog_list</code> 的 route 將會被匹配到，並且 <code>$page</code> 預設的數值為 <code>1</code>。</p>

<h2>進階的 Routing 範例</h2>

<p>記住所有前述的資訊，來看看這個進階的範例：</p>

<div class="code-block config"><div id="config-3dc7a893300eca7dee724edf6217a5b1" class="config">
    <ul class="nav nav-tabs" role="tablist"><li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#config-3dc7a893300eca7dee724edf6217a5b1-0" role="tab">
        Annotation
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-3dc7a893300eca7dee724edf6217a5b1-1" role="tab">
        Yaml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-3dc7a893300eca7dee724edf6217a5b1-2" role="tab">
        Xml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-3dc7a893300eca7dee724edf6217a5b1-3" role="tab">
        Php
    </a>
</li></ul>
    <div class="tab-content">
        <div class="code-block php annotation"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBundle/Controller/ArticleController.php</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">ArticleController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Route(</span>
<span class="sd">     *     &quot;/articles/{_locale}/{year}/{slug}.{_format}&quot;,</span>
<span class="sd">     *     defaults={&quot;_format&quot;: &quot;html&quot;},</span>
<span class="sd">     *     requirements={</span>
<span class="sd">     *         &quot;_locale&quot;: &quot;en|fr&quot;,</span>
<span class="sd">     *         &quot;_format&quot;: &quot;html|rss&quot;,</span>
<span class="sd">     *         &quot;year&quot;: &quot;\d+&quot;</span>
<span class="sd">     *     }</span>
<span class="sd">     * )</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$_locale</span><span class="p">,</span> <span class="nv">$year</span><span class="p">,</span> <span class="nv">$slug</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>

<div class="code-block yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># app/config/routing.yml</span>
<span class="nt">article_show</span><span class="p">:</span>
  <span class="nt">path</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">/articles/{_locale}/{year}/{slug}.{_format}</span>
  <span class="nt">defaults</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> _controller</span><span class="p">:</span> <span class="nv">AppBundle</span><span class="p p-Indicator">:</span><span class="nv">Article</span><span class="p p-Indicator">:</span><span class="nv">show</span><span class="p p-Indicator">,</span><span class="nt"> _format</span><span class="p">:</span> <span class="nv">html</span> <span class="p p-Indicator">}</span>
  <span class="nt">requirements</span><span class="p">:</span>
      <span class="nt">_locale</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">en|fr</span>
      <span class="nt">_format</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">html|rss</span>
      <span class="nt">year</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">\d+</span>
</pre></div>
</td></tr></table></div>

<div class="code-block xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- app/config/routing.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing</span>
<span class="s">        http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;article_show&quot;</span>
        <span class="na">path=</span><span class="s">&quot;/articles/{_locale}/{year}/{slug}.{_format}&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;_controller&quot;</span><span class="nt">&gt;</span>AppBundle:Article:show<span class="nt">&lt;/default&gt;</span>
        <span class="nt">&lt;default</span> <span class="na">key=</span><span class="s">&quot;_format&quot;</span><span class="nt">&gt;</span>html<span class="nt">&lt;/default&gt;</span>
        <span class="nt">&lt;requirement</span> <span class="na">key=</span><span class="s">&quot;_locale&quot;</span><span class="nt">&gt;</span>en|fr<span class="nt">&lt;/requirement&gt;</span>
        <span class="nt">&lt;requirement</span> <span class="na">key=</span><span class="s">&quot;_format&quot;</span><span class="nt">&gt;</span>html|rss<span class="nt">&lt;/requirement&gt;</span>
        <span class="nt">&lt;requirement</span> <span class="na">key=</span><span class="s">&quot;year&quot;</span><span class="nt">&gt;</span>\d+<span class="nt">&lt;/requirement&gt;</span>

    <span class="nt">&lt;/route&gt;</span>
<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</td></tr></table></div>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// app/config/routing.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Route</span><span class="p">;</span>

<span class="nv">$routes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
    <span class="s1">&#39;article_show&#39;</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/articles/{_locale}/{year}/{slug}.{_format}&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;_controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AppBundle:Article:show&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_format&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span>
    <span class="p">],</span> <span class="p">[</span>
        <span class="s1">&#39;_locale&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;en|fr&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_format&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;html|rss&#39;</span><span class="p">,</span>
        <span class="s1">&#39;year&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;\d+&#39;</span><span class="p">,</span>
    <span class="p">])</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nv">$routes</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
    </div>
</div></div>

<p>就像你看到的，該 route 只會在 <code>{_locale}</code> 為 <code>en</code> 或 <code>fr</code> 並且 <code>{year}</code> 是一個數字的情形下匹配成功，該 route 同時也告訴你可以在 {placeholder} 之間使用小數點 (<code>.</code>) 來取代斜線 (<code>/</code>)，匹配該 route 的網址有以下幾個可能：</p>

<ul>
<li><code>/articles/en/2010/my-post</code></li>
<li><code>/articles/fr/2010/my-post.rss</code></li>
<li><code>/articles/en/2013/my-latest-post.html</code></li>
</ul>

<div class="code-block sidebar"><p>特殊 Routing 參數 _format</p>

<p>這個範例也突顯了特殊的 routing 參數 <code>_format</code>，當使用此參數時，被匹配到的數值會成為 <code>Request</code> 物件的「請求格式 (request format)」。</p>

<p>最終，請求格式會被使用於像是 Response 的 <code>Content-Type</code> 等設定 (例如，<code>json</code> 的請求格式會被轉譯成 <code>application/json</code> 的 <code>application/json</code>)。這也可以用在 controller 中來繪製不同格式的範本，<code>_format</code> 這個參數是個很有用的方式來繪製同一個網頁內容，但使用不同的網頁格式。</p>

<p>在 Symfony 3.0 之前的版本，可以加入一個名為 <code>_format</code> 的 query 參數來覆蓋請求格式 (比如說：<code>/foo/bar?_format=json</code>)，這個方式被視為一個不好的實作方式，同時也會讓你升級 Symfony 3 的動作變得複雜。</p></div>

<div class="code-block note"><div class="note-title">
    <span class="fa-stack fa-md">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
    </span>
    <span class="text">Note</span>
</div><p>有時候你想要讓 route 的某部分能被設定在全域環境中，Symfony 中可以設定 service container 的參數來達到這件事，詳細可以閱讀「<a href="https://symfony.com/doc/3.4/routing/service_container_parameters.html">How to Use Service Container Parameters in your Routes</a>」。</p></div>

<h2>特殊 Routing 參數</h2>

<p>就像你看到的，每個 routing 參數或是預設值，最終都可以用在 controller method 中的參數上。此外，還有 4 個特殊的參數，每個都有特定的功能：</p>

<ul>
<li><code>_controller</code><br />
正如你所見，當 route 被匹配後，該參數用於決定要執行哪個 controller。</li>
<li><code>_format</code><br />
用於設定請求格式 (<a href="/symfony/3.4/routing#特殊-Routing-參數-_format">read more</a>)</li>
<li><p><code>_fragment</code><br />
用於設定 fragment 錨點，網址中最尾巴以 <code>#</code> 符號開始的部分，用於識別網頁中的某個部分。</p>

<div class="code-block"><div class="highlight"><pre><span></span>`_fragment` 參數功能加入於 Symfony 3.2。
</pre></div>
</div></li>
<li><p><code>_locale</code><br />
用於設定語系 (<a href="https://symfony.com/doc/3.4/translation/locale.html#translation-locale-url">read more</a>)。</p></li>
</ul>

<h2>帶有結尾斜線的重新導向網址</h2>

<p>從歷史的腳色來看，網址是遵從 UNIX 的慣例，在結尾處加入斜線作為資料夾 (像是 <code>https://example.com/foo/</code>)，在結尾處移除斜線作為檔案 (<code>https://example.com/foo</code>)。雖然要將兩種網址指向不同的內容是 OK 的，但現今將兩種網址指向同一個內容或是做重新導向已經變為一種共識了。</p>

<p>Symfony 遵從這樣的邏輯，重新導向有或是沒有結尾斜線的網址 (但只限於 <code>GET</code> 和 <code>HEAD</code> 請求)：</p>

<table class="table table-bordered">
<thead class="table-active">
<tr>
  <th>Route path</th>
  <th>如果請求網址為 /foo</th>
  <th>如果請求網址為 /foo/</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>/foo</code></td>
  <td>匹配成功 (<code>200</code> status response)</td>
  <td>匹配不成功 (<code>404</code> status response)</td>
</tr>
<tr>
  <td><code>/foo/</code></td>
  <td><code>301</code> 重新導向到 <code>/foo/</code></td>
  <td>匹配成功 (<code>200</code> status response)</td>
</tr>
</tbody>
</table>

<p>總結來說，在 route path 中加入結尾斜線是確保網址能運作正常的最佳作法，閱讀 <a href="https://symfony.com/doc/3.4/routing/redirect_trailing_slash.html"><em>Redirect URLs with a Trailing Slash</em></a> 的文章，學習如何避免在請求網址包含結尾的斜線但 route path 沒有時發生的 <code>404</code> 錯誤。</p>

<h2>Controller Naming Pattern</h2>

<p>If you use YAML, XML or PHP route configuration, then each route must have a <code>_controller</code> parameter, which dictates which controller should be executed when that route is matched. This parameter uses a simple string pattern called the <em>logical controller name</em>, which Symfony maps to a specific PHP method and class. The pattern has three parts, each separated by a colon:</p>

<blockquote>
  bundle:controller:action
  

</blockquote>

<p>For example, a <code>_controller</code> value of <code>AppBundle:Blog:show</code> means:</p>

<table class="table table-bordered">
<thead class="table-active">
<tr>
  <th>Bundle</th>
  <th>Controller Class</th>
  <th>Method Name</th>
</tr>
</thead>
<tbody>
<tr>
  <td>AppBundle</td>
  <td>BlogController</td>
  <td>showAction()</td>
</tr>
</tbody>
</table>

<p>The controller might look like this:</p>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBundle/Controller/BlogController.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$slug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>

<p>Notice that Symfony adds the string <code>Controller</code> to the class name (<code>Blog</code> => <code>BlogController</code>) and <code>Action</code> to the method name (<code>show</code> => <code>showAction()</code>).</p>

<p>You could also refer to this controller using its fully-qualified class name and method: <code>AppBundle\Controller\BlogController::showAction</code>. But if you follow some simple conventions, the logical name is more concise and allows more flexibility.</p>

<div class="code-block tip"><div class="tip-title">
    <span class="fa-stack fa-md">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-lightbulb-o fa-stack-1x fa-inverse"></i>
    </span>
    <span class="text">Tip</span>
</div><p>To refer to an action that is implemented as the <code>__invoke()</code> method of a controller class, you do not have to pass the method name, but can just use the fully qualified class name (e.g. <code>AppBundle\Controller\BlogController</code>).</p></div>

<div class="code-block note"><div class="note-title">
    <span class="fa-stack fa-md">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
    </span>
    <span class="text">Note</span>
</div><p>In addition to using the logical name or the fully-qualified class name, Symfony supports a third way of referring to a controller. This method uses just one colon separator (e.g. <code>service_name:indexAction</code>) and refers to the controller as a service (see <a href="https://symfony.com/doc/3.4/controller/service.html"><em>How to Define Controllers as Services</em></a>).</p></div>

<h2>Loading Routes</h2>

<p>Symfony loads all the routes for your application from a single routing configuration file: <code>app/config/routing.yml</code>. But from inside of this file, you can load any <em>other</em> routing files you want. In fact, by default, Symfony loads annotation route configuration from your AppBundle's <code>Controller/</code> directory, which is how Symfony sees our annotation routes:</p>

<div class="code-block config yaml xml php"><div id="config-3004dec042f0e1b613aa123c45cf404c" class="config">
    <ul class="nav nav-tabs" role="tablist"><li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#config-3004dec042f0e1b613aa123c45cf404c-0" role="tab">
        Yaml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-3004dec042f0e1b613aa123c45cf404c-1" role="tab">
        Xml
    </a>
</li><li class="nav-item">
    <a class="nav-link " data-toggle="tab" href="#config-3004dec042f0e1b613aa123c45cf404c-2" role="tab">
        Php
    </a>
</li></ul>
    <div class="tab-content">
        <div class="code-block yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># app/config/routing.yml</span>
<span class="nt">app</span><span class="p">:</span>
    <span class="nt">resource</span><span class="p">:</span> <span class="s">&quot;@AppBundle/Controller/&quot;</span>
    <span class="nt">type</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">annotation</span>
</pre></div>
</td></tr></table></div>

<div class="code-block xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- app/config/routing.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing</span>
<span class="s">        http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- the type is required to enable the annotation reader for this resource --&gt;</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;@AppBundle/Controller/&quot;</span> <span class="na">type=</span><span class="s">&quot;annotation&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</td></tr></table></div>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// app/config/routing.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>

<span class="nv">$routes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$routes</span><span class="o">-&gt;</span><span class="na">addCollection</span><span class="p">(</span>
    <span class="c1">// second argument is the type, which is required to enable</span>
    <span class="c1">// the annotation reader for this resource</span>
    <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="s2">&quot;@AppBundle/Controller/&quot;</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">return</span> <span class="nv">$routes</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
    </div>
</div></div>

<p>For more details on loading routes, including how to prefix the paths of loaded routes, see <a href="https://symfony.com/doc/3.4/routing/external_resources.html"><em>How to Include External Routing Resources</em></a>.</p>

<h2>Generating URLs</h2>

<p>The routing system should also be used to generate URLs. In reality, routing is a bidirectional system: mapping the URL to a controller and a route back to a URL.</p>

<p>To generate a URL, you need to specify the name of the route (e.g. <code>blog_show</code>) and any wildcards (e.g. <code>slug = my-blog-post</code>) used in the path for that route. With this information, any URL can easily be generated:</p>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$slug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>

        <span class="c1">// /blog/my-blog-post</span>
        <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span>
            <span class="s1">&#39;blog_show&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-blog-post&#39;</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>

<div class="code-block note"><div class="note-title">
    <span class="fa-stack fa-md">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
    </span>
    <span class="text">Note</span>
</div><p>The <code>generateUrl()</code> method defined in the base <a href="https://github.com/symfony/symfony/blob/3.4/src/Symfony/Bundle/FrameworkBundle/Controller/Controller.php">Controller</a> class is just a shortcut for this code:</p>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span>
    <span class="s1">&#39;blog_show&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-blog-post&#39;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>

<h2>Generating URLs with Query Strings</h2>

<p>The <code>generate()</code> method takes an array of wildcard values to generate the URI. But if you pass extra ones, they will be added to the URI as a query string:</p>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;category&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Symfony&#39;</span><span class="p">,</span>
<span class="p">]);</span>
<span class="c1">// /blog/2?category=Symfony</span>
</pre></div>
</td></tr></table></div>

<h2>Generating URLs from a Template</h2>

<p>To generate URLs inside Twig, see the templating article: <a href="https://symfony.com/doc/3.4/templating.html#templating-pages">Linking to Pages</a>. If you also need to generate URLs in JavaScript, see <a href="https://symfony.com/doc/3.4/routing/generate_url_javascript.html"><em>How to Generate Routing URLs in JavaScript</em></a>.</p>

<h2>Generating Absolute URLs</h2>

<p>By default, the router will generate relative URLs (e.g. <code>/blog</code>). From a controller, pass <code>UrlGeneratorInterface::ABSOLUTE_URL</code> to the third argument of the <code>generateUrl()</code> method:</p>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Routing\Generator\UrlGeneratorInterface</span><span class="p">;</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">&#39;blog_show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-blog-post&#39;</span><span class="p">],</span> <span class="nx">UrlGeneratorInterface</span><span class="o">::</span><span class="na">ABSOLUTE_URL</span><span class="p">);</span>
<span class="c1">// http://www.example.com/blog/my-blog-post</span>
</pre></div>
</td></tr></table></div>

<div class="code-block note"><div class="note-title">
    <span class="fa-stack fa-md">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
    </span>
    <span class="text">Note</span>
</div><p>The host that's used when generating an absolute URL is automatically detected using the current <code>Request</code> object. When generating absolute URLs from outside the web context (for instance in a console command) this doesn't work. See <a href="https://symfony.com/doc/3.4/console/request_context.html"><em>How to Generate URLs from the Console</em></a> to learn how to solve this problem.</p></div>

<h2>Troubleshooting</h2>

<p>Here are some common errors you might see while working with routing:</p>

<blockquote>
  Controller "AppBundle\Controller\BlogController::showAction()" requires that you provide a value for the "$slug" argument.
  

</blockquote>

<p>This happens when your controller method has an argument (e.g. <code>$slug</code>):</p>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$slug</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ..</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>

<p>But your route path does not have a <code>{slug}</code> wildcard (e.g. it is <code>/blog/show</code>). Add a <code>{slug}</code> to your route path: <code>/blog/show/{slug}</code> or give the argument a default value (i.e. <code>$slug = null</code>).</p>

<blockquote>
  Some mandatory parameters are missing ("slug") to generate a URL for route "blog_show".
  

</blockquote>

<p>This means that you're trying to generate a URL to the <code>blog_show</code> route but you are <em>not</em> passing a <code>slug</code> value (which is required, because it has a <code>{slug}</code>) wildcard in the route path. To fix this, pass a <code>slug</code> value when generating the route:</p>

<div class="code-block php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">&#39;blog_show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug-value&#39;</span><span class="p">]);</span>

<span class="c1">// or, in Twig</span>
<span class="c1">// {{ path(&#39;blog_show&#39;, {&#39;slug&#39;: &#39;slug-value&#39;}) }}</span>
</pre></div>
</td></tr></table></div>

<h2>Translating Routes</h2>

<p>Symfony doesn't support defining routes with different contents depending on the user language. In those cases, you can define multiple routes per controller, one for each supported language; or use any of the bundles created by the community to implement this feature, such as <a href="https://github.com/schmittjoh/JMSI18nRoutingBundle">JMSI18nRoutingBundle</a> and <a href="https://github.com/BeSimple/BeSimpleI18nRoutingBundle">BeSimpleI18nRoutingBundle</a>.</p>

<h2>Summary</h2>

<p>Routing is a system for mapping the URL of incoming requests to the controller function that should be called to process the request. It both allows you to specify beautiful URLs and keeps the functionality of your application decoupled from those URLs. Routing is a bidirectional mechanism, meaning that it should also be used to generate URLs.</p>

<h2>Keep Going!</h2>

<p>Routing, check! Now, uncover the power of <a href="https://symfony.com/doc/3.4/controller.html"><em>controllers</em></a>.</p>

<div class="code-block see-also"><div class="see-also-title">
    <span class="fa-stack fa-md">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-share fa-stack-1x fa-inverse"></i>
    </span>
    <span class="text">See Also</span>
</div><p>此篇文章主要翻譯自 Symfony 官方文件，並做了些許的修改，原始文章請見<a href="https://symfony.com/doc/3.4/routing.html">此連結</a></p></div>

                </div>
            </article>
            <hr class="offset-top-66">
            <h4 class="offset-top-66 text-uppercase text-spacing-120 font-weight-bold">Comments</h4>
            <div class="offset-top-41">
                <div id="disqus_thread"></div>
<script type="text/javascript">
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = 'https://glisland.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
    </div>
</div>
    </main>

    <!-- Page Footer -->
    <footer class="section-relative page-footer bg-gray-base context-dark">
        <div class="container text-white">
            <div class="row">
                <div class="col-sm-6 text-center text-sm-left">
                    Copyright &copy; 2018
                    <a href="/author">
                        <span class="ml-1">leo.on.the.earth</span>
                    </a>
                </div>
                <div class="col-sm-6 text-center text-sm-right">
                    <ul class="list-inline social-media">
                                                                                                        <li class="list-inline-item">
                            <a class="icon fa fa-github-alt icon-xxs icon-circle icon-darkest-filled"
                               href="https://github.com/LeoOnTheEarth" target="_blank"></a>
                        </li>
                                        </ul>
                </div>
            </div>
        </div>
    </footer>
</div>

<!-- Javascript -->
<script src="/themes/default/js/core.min.js?v0.0.1"></script>
<script src="/themes/default/js/script.js?v0.0.1"></script>

<script type="text/javascript">
    [].forEach.call(document.querySelectorAll('.gp, .c1'), function (gp) {
        gp.dataset.content = gp.textContent;
    });

    function updateConfigCodeBlocks()
    {
        $('.code-block.config .config').each(function() {
            var $node = $(this);
            var id = $node.attr('id');

            $node.find('.tab-content > div.code-block').each(function(i, elem) {
                var $block = $(this);
                var classes = 'tab-pane fade' + (i === 0 ? ' show active' : '');

                $block.addClass(classes);
                $block.attr('id', id + '-' + i.toString());
            });
        });
    }
    updateConfigCodeBlocks();
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34288948-1" type="text/javascript"></script>
<script type="text/javascript">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34288948-1');
  
  
</script>

</body>
</html>
